import{_ as l,r as u,o as e,c,d as s,a as t,w as p,b as o,e as n}from"./app.1e9a03a3.js";const i={},k=o('<p><a href="">JWT</a> l\xE0 m\u1ED9t h\xECnh th\u1EE9c x\xE1c th\u1EF1c ng\u01B0\u1EDDi d\xF9ng r\u1EA5t b\u1EA3o m\u1EADt, hi\u1EC7u qu\u1EA3 v\xE0 ph\u1ED5 bi\u1EBFn trong m\xF4 h\xECnh<a href="">CSR</a></p><p><img src="https://github.com/dangtranhuu/images/blob/main/frogcyber/post/jwtspringboot/main.png?raw=true" alt=""></p><p>Trong l\xFAc t\u1EF1 h\u1ECDc RestfulAPI v\u1EDBi <a href="">SpringBoot</a> m\xECnh \u0111\xE3 x\xE2y d\u1EF1ng m\u1ED9t Web app (SpringBoot, SQL, Angular). B\u1EA1n c\xF3 th\u1EC3 xem m\xE3 ngu\u1ED3n t\u1EA1i <a href="https://github.com/Theanishtar/Davitickets" target="_blank" rel="noopener noreferrer">\u0111\xE2y</a></p><p>Trong \u0111\xF3 c\xF3 ch\u1EE9c n\u0103ng X\xE1c th\u1EF1c b\u1EB1ng <strong>JWT</strong> <em>(Json Web Token)</em>, m\xECnh s\u1EBD c\xF9ng t\xECm hi\u1EC3u trong b\xE0i vi\u1EBFt h\xF4m nay nh\xE9!!!</p><p>M\xECnh c\xF3 m\u1ED9t s\u1ED1 l\u01B0u \xFD sau \u0111\xE2y:</p>',5),r=n("B\xE0i vi\u1EBFt h\xF4m nay ch\u1EC9 \u0111\u1EC1 c\u1EADp \u0111\u1EBFn JWT trong SpringBoot n\xEAn ph\u1EA3i c\xF3 ki\u1EBFn th\u1EE9c v\u1EC1 c\u1EA3 "),d=s("a",{href:""},"JWT",-1),g=n(" v\xE0 "),m=n("SpringBoot"),h=n(" nh\xE9"),y=s("li",null,"B\xE0i vi\u1EBFt n\xE0y \u0111\u01B0\u1EE3c m\xECnh l\u1EA5y tr\u1EF1c ti\u1EBFp t\u1EEB d\u1EF1 \xE1n \u0111\xE3 x\xE2y d\u1EF1ng n\xEAn c\xF3 g\xEC ch\u01B0a hi\u1EC3u b\u1EA1n h\xE3y xem m\xE3 ngu\u1ED3n c\u1EE7a d\u1EF1 \xE1n nh\xE9",-1),w=o(`<p>Okay b\u1EAFt \u0111\u1EA7u thoy !!!</p><details class="custom-container details"><summary><b>N\u1ED9i dung ch\xEDnh</b></summary><p>S\u1EBD c\u1EADp nh\u1EADt sau ^^</p></details><h2 id="xay-dung-csdl" tabindex="-1"><a class="header-anchor" href="#xay-dung-csdl" aria-hidden="true">#</a> X\xE2y d\u1EF1ng CSDL</h2><p><img src="https://github.com/dangtranhuu/images/blob/main/angurvad/backend/jwt/diagram.png?raw=true" alt="Diagram DB"></p><p>Nh\u01B0 b\u1EA1n th\u1EA5y \u1EDF h\xECnh tr\xEAn ta c\u1EA7n 3 Table ch\xEDnh li\xEAn quan \u0111\u1EBFn ng\u01B0\u1EDDi d\xF9ng g\u1ED3m: <strong>Users</strong>, <strong>Roles</strong> v\xE0 <strong>UserRole</strong>.</p><details class="custom-container details"><summary><b>Chi ti\u1EBFt:</b></summary><p><strong>Users</strong>: ch\u1EE9a danh s\xE1ch ng\u01B0\u1EDDi d\xF9ng</p><p><strong>Roles</strong>: ch\u1EE9a t\u1EA5t c\u1EA3 c\xE1c quy\u1EC1n trong h\u1EC7 th\u1ED1ng</p><p><strong>UserRole</strong>: b\u1EA3ng trung gian li\xEAn k\u1EBFt N-N trong h\u1EC7 th\u1ED1ng</p></details><h3 id="ma-nguon-my-sql" tabindex="-1"><a class="header-anchor" href="#ma-nguon-my-sql" aria-hidden="true">#</a> M\xE3 ngu\u1ED3n My-SQL</h3><h4 id="tao-bang" tabindex="-1"><a class="header-anchor" href="#tao-bang" aria-hidden="true">#</a> T\u1EA1o b\u1EA3ng</h4><details class="custom-container details"><summary><b>Code SQL</b></summary><div class="language-sql ext-sql"><pre class="language-sql"><code><span class="token comment">--Quy\u1EC1n</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> roles<span class="token punctuation">(</span>
    role_id <span class="token keyword">INT</span> <span class="token keyword">IDENTITY</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token punctuation">[</span>name<span class="token punctuation">]</span> NVARCHAR<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	role_des NVARCHAR<span class="token punctuation">(</span>max<span class="token punctuation">)</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span>

<span class="token comment">--Ng\u01B0\u1EDDi d\xF9ng</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> users <span class="token punctuation">(</span>
	userid <span class="token keyword">INT</span> <span class="token keyword">IDENTITY</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	full_name NVARCHAR<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token punctuation">[</span>user_name<span class="token punctuation">]</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	gender NVARCHAR<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	user_password <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span>MAX<span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	phone <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	profile_picture <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span>MAX<span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	account_status <span class="token keyword">BIT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token comment">--tr\u1EA1ng th\xE1i ho\u1EA1t \u0111\u1ED9ng</span>
	processed_by <span class="token keyword">BIT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token comment">--x\xE1c th\u1EF1c</span>
	user_birtday <span class="token keyword">DATE</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	user_dayjoin <span class="token keyword">DATE</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	gg_id <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span>MAX<span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment">-- Li\xEAn k\u1EBFt Ng\u01B0\u1EDDi d\xF9ng v\u1EDBi Quy\u1EC1n</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> user_role<span class="token punctuation">(</span>
	id <span class="token keyword">INT</span> <span class="token keyword">IDENTITY</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	userid <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token keyword">REFERENCES</span> users<span class="token punctuation">(</span>userid<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">--id ng dung</span>
	role_id <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token keyword">REFERENCES</span> roles<span class="token punctuation">(</span>role_id<span class="token punctuation">)</span><span class="token comment">--Vai tr\xF2 ng\u01B0\u1EDDi d\xF9ng</span>
<span class="token punctuation">)</span>
</code></pre></div></details><h4 id="them-du-lieu" tabindex="-1"><a class="header-anchor" href="#them-du-lieu" aria-hidden="true">#</a> Th\xEAm d\u1EEF li\u1EC7u</h4><details class="custom-container details"><summary><b>M\xE3 SQL</b></summary><div class="language-sql ext-sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> roles <span class="token keyword">VALUES</span>
	<span class="token punctuation">(</span><span class="token string">&#39;ROLE_ADMIN&#39;</span><span class="token punctuation">,</span>N<span class="token string">&#39;Qu\u1EA3n tr\u1ECB web&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token string">&#39;ROLE_USER&#39;</span><span class="token punctuation">,</span>N<span class="token string">&#39;Ng\u01B0\u1EDDi d\xF9ng&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> users <span class="token keyword">VALUES</span> 
	<span class="token punctuation">(</span>N<span class="token string">&#39;Tr\u1EA7n H\u1EEFu \u0110ang&#39;</span><span class="token punctuation">,</span>N<span class="token string">&#39;dangth&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Nam&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;$2a$10$AR78OxmWNlFMnmFlv.XWFe2TECixCdfV.2K9G4yrmQ1irWXvxcL72&#39;</span><span class="token punctuation">,</span> N<span class="token string">&#39;0917288723&#39;</span><span class="token punctuation">,</span> N<span class="token string">&#39;dangthpc04349@fpt.edu.vn&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;https://firebasestorage.googleapis.com/v0/b/davitickets-2e627.appspot.com/o/dangth.jpg?alt=media&amp;token=e223770c-06cb-448e-9025-43000f55d764&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> CAST<span class="token punctuation">(</span><span class="token string">&#39;9-7-2003&#39;</span> <span class="token keyword">AS</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CAST<span class="token punctuation">(</span><span class="token string">&#39;7-22-2023&#39;</span> <span class="token keyword">AS</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span>N<span class="token string">&#39;L\xEA B\xEDch Vi&#39;</span><span class="token punctuation">,</span> N<span class="token string">&#39;vilb&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;N\u1EEF&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;$2a$10$SvchmABRVVZjeLgOW4Dez.q7T1kcybCdiQF70DHKNs.nX30vmYLVi&#39;</span><span class="token punctuation">,</span> N<span class="token string">&#39;0178296424&#39;</span><span class="token punctuation">,</span> N<span class="token string">&#39;vilbpc04354@fpt.edu.vn&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;https://firebasestorage.googleapis.com/v0/b/davitickets-2e627.appspot.com/o/vilb.jpg?alt=media&amp;token=83641b31-7ea9-432d-bd6b-4dd0f5e9062f&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> CAST<span class="token punctuation">(</span><span class="token string">&#39;6-2-2003&#39;</span> <span class="token keyword">AS</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CAST<span class="token punctuation">(</span><span class="token string">&#39;7-22-2023&#39;</span> <span class="token keyword">AS</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span>N<span class="token string">&#39;Ph\xF9ng Qu\u1ED1c Vinh&#39;</span><span class="token punctuation">,</span>N<span class="token string">&#39;vinhpq&#39;</span><span class="token punctuation">,</span>  <span class="token string">&#39;Nam&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;$2a$10$aF6y9hGg06.We5mXYua13eM/N4o2wq0UZSD2JgC0PVja.1x1chXjS&#39;</span><span class="token punctuation">,</span> N<span class="token string">&#39;0862738927&#39;</span><span class="token punctuation">,</span> N<span class="token string">&#39;vinhpqpc04338@fpt.edu.vn&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;https://firebasestorage.googleapis.com/v0/b/davitickets-2e627.appspot.com/o/vinhpq.jpg?alt=media&amp;token=635b97b6-bdf4-49b5-ae07-a802c17a979e&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> CAST<span class="token punctuation">(</span><span class="token string">&#39;11-15-2003&#39;</span> <span class="token keyword">AS</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CAST<span class="token punctuation">(</span><span class="token string">&#39;7-22-2023&#39;</span> <span class="token keyword">AS</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span>N<span class="token string">&#39;\u0110o\xE0n Hi\u1EC7p S\u1EF9&#39;</span><span class="token punctuation">,</span>N<span class="token string">&#39;sydh&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Nam&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;$2a$10$DYKf7ahE.Feac9JEy8exP.hMYXtaI5aayfeYua0ZCGVV0RXvu5.Gy&#39;</span><span class="token punctuation">,</span> N<span class="token string">&#39;0836452473&#39;</span><span class="token punctuation">,</span> N<span class="token string">&#39;sydhpc04388@fpt.edu.vn&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;https://firebasestorage.googleapis.com/v0/b/davitickets-2e627.appspot.com/o/sydh.jpg?alt=media&amp;token=f907c8e9-4712-4448-b7a9-1d9df8f9b053&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> CAST<span class="token punctuation">(</span><span class="token string">&#39;4-7-2003&#39;</span> <span class="token keyword">AS</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CAST<span class="token punctuation">(</span><span class="token string">&#39;7-22-2023&#39;</span> <span class="token keyword">AS</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span>N<span class="token string">&#39;Nguy\u1EC5n Kh\xE1nh \u0110an&#39;</span><span class="token punctuation">,</span>N<span class="token string">&#39;dannk&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;N\u1EEF&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;$2a$10$CRFxFV1oJiYT0rTa3STe.ubKEz1V59HrdOSCl1OA6uVG2xYretjQ6&#39;</span><span class="token punctuation">,</span> N<span class="token string">&#39;0924637483&#39;</span><span class="token punctuation">,</span> N<span class="token string">&#39;dannkpc04351@fpt.edu.vn&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;https://firebasestorage.googleapis.com/v0/b/davitickets-2e627.appspot.com/o/dannk.jpg?alt=media&amp;token=2cb34557-c380-4095-8a10-8a211add0940&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> CAST<span class="token punctuation">(</span><span class="token string">&#39;11-7-2003&#39;</span> <span class="token keyword">AS</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CAST<span class="token punctuation">(</span><span class="token string">&#39;7-22-2023&#39;</span> <span class="token keyword">AS</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span>N<span class="token string">&#39;Ch\xE2u Ho\xE0i Ph\xFAc&#39;</span><span class="token punctuation">,</span> N<span class="token string">&#39;phucch&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;Nam&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;$2a$10$pT5QFvN2Ha5jiOCtZTK.ZOY0dS5MKC/K31S2jyg2Ln978nju1BxCq&#39;</span><span class="token punctuation">,</span> N<span class="token string">&#39;0918093162&#39;</span><span class="token punctuation">,</span> N<span class="token string">&#39;phucchpc04191@fpt.edu.vn&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;https://firebasestorage.googleapis.com/v0/b/davitickets-2e627.appspot.com/o/phucch.jpg?alt=media&amp;token=8ee61c10-23b1-41a5-97ed-b1e0e6d894ed&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> CAST<span class="token punctuation">(</span><span class="token string">&#39;11-2-2003&#39;</span> <span class="token keyword">AS</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CAST<span class="token punctuation">(</span><span class="token string">&#39;7-22-2023&#39;</span> <span class="token keyword">AS</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span>N<span class="token string">&#39;Qu\xE1ch H\u1EEFu Ngh\u0129a&#39;</span><span class="token punctuation">,</span>N<span class="token string">&#39;nghiahq&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Nam&#39;</span><span class="token punctuation">,</span> N<span class="token string">&#39;$2a$10$WzBhlbBVtJxyafSiM1os9.4S0tDkSmoYgWY/om0Ma7dBBz9jlpUUq&#39;</span><span class="token punctuation">,</span> N<span class="token string">&#39;012346789&#39;</span><span class="token punctuation">,</span> N<span class="token string">&#39;nghiaqh@fe.edu.vn&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;https://firebasestorage.googleapis.com/v0/b/davitickets-2e627.appspot.com/o/thaynghia.jpg?alt=media&amp;token=9fc95aed-1dfe-4b87-8ebe-2903ffd50678&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> CAST<span class="token punctuation">(</span><span class="token string">&#39;1-1-1990&#39;</span> <span class="token keyword">AS</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CAST<span class="token punctuation">(</span><span class="token string">&#39;7-22-2023&#39;</span> <span class="token keyword">AS</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> user_role <span class="token keyword">VALUES</span>
	<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token number">2</span> <span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token number">3</span> <span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token number">4</span> <span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token number">5</span> <span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token number">6</span> <span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token number">7</span> <span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token number">7</span> <span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre></div></details><p>Ta c\xF3 th\u1EC3 l\u1EA5y ra c\xE1c th\xF4ng tin v\xE0 quy\u1EC1n c\u1EE7a m\u1ED9t <strong>User</strong> \u1EE9ng v\u1EDBi <code>email</code> v\xE0 <code>password</code> b\u1EB1ng c\xE2u truy v\u1EA5n sau:</p><div class="language-sql ext-sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> 
	u<span class="token punctuation">.</span>fullname<span class="token punctuation">,</span> u<span class="token punctuation">.</span>email<span class="token punctuation">,</span> GROUP_CONCAT<span class="token punctuation">(</span>r<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token keyword">AS</span> roles
<span class="token keyword">FROM</span> roles r
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> 
	userrole ur <span class="token keyword">ON</span> r<span class="token punctuation">.</span>id <span class="token operator">=</span> ur<span class="token punctuation">.</span>roleid
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> 
	account u <span class="token keyword">ON</span> ur<span class="token punctuation">.</span>username <span class="token operator">like</span> u<span class="token punctuation">.</span>username
<span class="token keyword">WHERE</span> 
	u<span class="token punctuation">.</span>email <span class="token operator">like</span> <span class="token string">&#39;\${email}&#39;</span> <span class="token operator">and</span> u<span class="token punctuation">.</span>password <span class="token operator">like</span> <span class="token string">&#39;\${password}&#39;</span> 
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> u<span class="token punctuation">.</span>email<span class="token punctuation">;</span>
</code></pre></div><p>K\u1EBFt qu\u1EA3:</p><table><thead><tr><th>Fullname</th><th>Email</th><th>Roles</th></tr></thead><tbody><tr><td>Tr\u1EA7n H\u1EEFu \u0110ang</td><td>dangtt135@gmail.com</td><td>ROLE_ADMIN, ROLE_MANAGER</td></tr><tr><td>Frog Dev</td><td>frogdev@gmail.com</td><td>ROLE_USER</td></tr><tr><td>Nguy\u1EC5n Nh\xE2n Vi\xEAn</td><td>viennn@gmail.com</td><td>ROLE_STAFF</td></tr></tbody></table><h2 id="tao-du-an" tabindex="-1"><a class="header-anchor" href="#tao-du-an" aria-hidden="true">#</a> T\u1EA1o d\u1EF1 \xE1n</h2><h3 id="tao-du-an-voi-spring-tools-sute" tabindex="-1"><a class="header-anchor" href="#tao-du-an-voi-spring-tools-sute" aria-hidden="true">#</a> T\u1EA1o d\u1EF1 \xE1n v\u1EDBi Spring Tools Sute</h3>`,17),b={class:"custom-container tip"},v={viewBox:"0 0 25 25",xmlns:"http://www.w3.org/2000/svg","xml:space":"preserve",style:{"fill-rule":"evenodd","clip-rule":"evenodd","stroke-linejoin":"round","stroke-miterlimit":"2"}},f=s("path",{d:"M297.6 258.73H296c-59.47.87-110.69 51.45-111.83 110.43-.626 36.485 16.525 71.085 45.94 92.68 17.86 13.18 29.88 33.56 33.77 56.42h67.62c4-22.82 16.13-43.3 34.16-56.74 28.589-21.097 45.496-54.587 45.496-90.118 0-30.03-12.078-58.833-33.496-79.882a113.133 113.133 0 0 0-80.06-32.79ZM265.19 550.7v26.6c0 4.84 1.17 6.43 1.17 6.43l63.72-.59V550.7h-64.89Z",style:{fill:"#48b884","fill-rule":"nonzero"},transform:"matrix(.042 0 0 .042 0 -5.178)"},null,-1),T=s("path",{d:"M297.64 123.3C133.26 123.3 0 256.56 0 420.94s133.26 297.63 297.64 297.63 297.63-133.25 297.63-297.63S462 123.3 297.64 123.3ZM385 487.57c-14.11 10.48-22.51 28.09-22.51 47.14v48.43c-.016 17.792-14.648 32.428-32.44 32.45h-64.86c-15.6 0-32.44-12-32.44-38.29v-42.82c0-19-8.21-36.4-21.93-46.52-37.882-27.85-59.959-72.44-59.14-119.45 1.46-77.24 66-141.09 143.81-142.22 38.87.19 76.89 14.37 105 42.11a143.764 143.764 0 0 1 43.14 103c-.159 45.761-21.911 88.86-58.63 116.17Z",style:{fill:"#48b884","fill-rule":"nonzero"},transform:"matrix(.042 0 0 .042 0 -5.178)"},null,-1),A=[f,T],S=s("p",{class:"custom-container-title"},[s("b",null,"M\u1EB8O")],-1),N=n("C\xE1c b\u1EA1n c\xF3 th\u1EC3 t\u1EA3i "),R=n("Spring Tools Sute"),_=n(" t\u1EA1i "),E=s("a",{href:""},"\u0111\xE2y",-1),L=n(" nh\xE9."),q=n("Ho\u1EB7c c\u0169ng c\xF3 th\u1EC3 s\u1EED d\u1EE5ng "),j=n("VS Code"),C=n(" thay th\u1EBF!"),x=o(`<p>C\xE1c b\u1EA1n t\u1EA1o d\u1EF1 <code>Spring Stater Project</code> v\xE0 th\xEAm c\xE1c <code>dependencies</code> sau nh\xE9 (m\xECnh s\u1EBD b\u1ECF qua c\xE1c <em>dependencies</em> m\u1EB7c \u0111\u1ECBnh v\xE0 ch\u1EC9 \u0111\u1EC1 c\u1EADp \u0111\u1EBFn nh\u1EEFng <em>dependencies</em> c\u1EA7n thi\u1EBFt cho d\u1EF1 \xE1n h\xF4m nay th\xF4i nh\xE9)</p><p><em>pom.xml</em></p><div class="language-xml ext-xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>		
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.jsonwebtoken<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jjwt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.9.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.auth0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>java-jwt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.19.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="cau-hinh-cac-bien-moi-truong" tabindex="-1"><a class="header-anchor" href="#cau-hinh-cac-bien-moi-truong" aria-hidden="true">#</a> C\u1EA5u h\xECnh c\xE1c bi\u1EBFn m\xF4i tr\u01B0\u1EDDng</h3>`,4),U=n("T\xF9y ch\u1EC9nh theo y\xEAu c\u1EA7u c\u1EE7a b\u1EA1n trong t\u1EC7p "),I=s("code",null,"application.properties",-1),D=o(`<div class="language-properties ext-properties"><pre class="language-properties"><code><span class="token key attr-name">spring.jpa.properties.hibernate.enable_lazy_load_no_trans</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>

<span class="token comment">#dtb</span>
<span class="token key attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:sqlserver://localhost:1433;databaseName=DaviTickets;encrypt=true;trustServerCertificate=true;</span>
<span class="token key attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token value attr-value">sa</span>
<span class="token key attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token value attr-value">123</span>
<span class="token key attr-name">spring.datasource.driverClassName</span><span class="token punctuation">=</span><span class="token value attr-value">com.microsoft.sqlserver.jdbc.SQLServerDriver</span>

<span class="token comment">#JWT</span>
<span class="token key attr-name">jwt.secret</span><span class="token punctuation">=</span><span class="token value attr-value">davisy@poly@@</span>
<span class="token key attr-name">jwt.header</span><span class="token punctuation">=</span><span class="token value attr-value">Authorization</span>
<span class="token key attr-name">jwt.value</span><span class="token punctuation">=</span><span class="token value attr-value">Bearer</span>
</code></pre></div><h2 id="tao-cac-\u0111oi-tuong-entities" tabindex="-1"><a class="header-anchor" href="#tao-cac-\u0111oi-tuong-entities" aria-hidden="true">#</a> T\u1EA1o c\xE1c \u0111\u1ED1i t\u01B0\u1EE3ng Entities</h2><ul><li>\u0110\u1ED1i t\u01B0\u1EE3ng <code>Users</code> implement l\u1EDBp <code>UserDetails</code></li></ul><p><em>User.java</em></p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Users</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetails</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Id</span>
	<span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
	<span class="token keyword">int</span> userid<span class="token punctuation">;</span>
	<span class="token class-name">String</span> full_name<span class="token punctuation">;</span>
	<span class="token class-name">String</span> user_name<span class="token punctuation">;</span>
	<span class="token class-name">String</span> gender<span class="token punctuation">;</span>
	<span class="token class-name">String</span> user_password<span class="token punctuation">;</span>
	<span class="token class-name">String</span> phone<span class="token punctuation">;</span>
	<span class="token class-name">String</span> email<span class="token punctuation">;</span>
	<span class="token class-name">String</span> profile_picture<span class="token punctuation">;</span>
	<span class="token keyword">boolean</span> account_status<span class="token punctuation">;</span>
	<span class="token class-name">Boolean</span> processed_by<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Temporal</span><span class="token punctuation">(</span><span class="token class-name">TemporalType</span><span class="token punctuation">.</span>DATE<span class="token punctuation">)</span>
	<span class="token class-name">Date</span> user_birtday <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Temporal</span><span class="token punctuation">(</span><span class="token class-name">TemporalType</span><span class="token punctuation">.</span>DATE<span class="token punctuation">)</span>
	<span class="token class-name">Date</span> user_dayjoin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> gg_id<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@JsonIgnore</span>
	<span class="token annotation punctuation">@OneToMany</span><span class="token punctuation">(</span>cascade <span class="token operator">=</span> <span class="token class-name">CascadeType</span><span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">,</span> mappedBy <span class="token operator">=</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Booking</span><span class="token punctuation">&gt;</span></span> booking<span class="token punctuation">;</span>


	<span class="token annotation punctuation">@ManyToMany</span><span class="token punctuation">(</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">,</span> targetEntity <span class="token operator">=</span> <span class="token class-name">Roles</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@JoinTable</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user_role&quot;</span><span class="token punctuation">,</span> joinColumns <span class="token operator">=</span> <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;userid&quot;</span><span class="token punctuation">,</span> referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;userid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> inverseJoinColumns <span class="token operator">=</span> <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;role_id&quot;</span><span class="token punctuation">,</span> referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;role_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Roles</span><span class="token punctuation">&gt;</span></span> roles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Roles</span> role <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>roles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			roles<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>role<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> roles<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SimpleGrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Roles</span> role <span class="token operator">:</span> roles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            authorities<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleGrantedAuthority</span><span class="token punctuation">(</span>role<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ROLE: &quot;</span> <span class="token operator">+</span> role<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> authorities<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;USER&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;ADMIN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>\u0110\u1ED1i t\u01B0\u1EE3ng <code>Roles</code></li></ul><p><em>Roles.java</em></p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;roles&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Roles</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Id</span>
	<span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
	<span class="token class-name">Integer</span> role_id<span class="token punctuation">;</span>

	<span class="token class-name">String</span> name<span class="token punctuation">;</span>
	<span class="token class-name">String</span> role_des<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@ManyToMany</span><span class="token punctuation">(</span> mappedBy <span class="token operator">=</span> <span class="token string">&quot;roles&quot;</span><span class="token punctuation">,</span>targetEntity <span class="token operator">=</span> <span class="token class-name">Users</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Users</span><span class="token punctuation">&gt;</span></span>user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="tao-cac-models-tuong-tac-database" tabindex="-1"><a class="header-anchor" href="#tao-cac-models-tuong-tac-database" aria-hidden="true">#</a> T\u1EA1o c\xE1c models t\u01B0\u01A1ng t\xE1c Database</h2><h3 id="lop-userdao" tabindex="-1"><a class="header-anchor" href="#lop-userdao" aria-hidden="true">#</a> L\u1EDBp UserDAO</h3><p><em>UserDAO.java</em></p><div class="language-java ext-java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>davisys<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">JpaRepository</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">Query</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>davisys<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Users</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDAO</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Users</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;SELECT * FROM users WHERE email=:email OR phone=:email&quot;</span><span class="token punctuation">,</span> nativeQuery <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">Users</span> <span class="token function">findEmaiAndPhonelUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;SELECT * FROM users WHERE email=:email &quot;</span><span class="token punctuation">,</span> nativeQuery <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">Users</span> <span class="token function">findEmailUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;SELECT * FROM users WHERE email=:email OR phone=:phone&quot;</span><span class="token punctuation">,</span> nativeQuery <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">Users</span> <span class="token function">findPhoneAndEmailUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em>RoleDAO.java</em></p><div class="language-java ext-java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>davisys<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">JpaRepository</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>davisys<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Roles</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RoleDAO</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Roles</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="repositories" tabindex="-1"><a class="header-anchor" href="#repositories" aria-hidden="true">#</a> Repositories</h3><p><em>RoleCustomRepo.java</em></p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RoleCustomRepo</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@PersistenceContext</span>
	<span class="token keyword">private</span> <span class="token class-name">EntityManager</span> entityManager<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Roles</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRole</span><span class="token punctuation">(</span><span class="token class-name">Users</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">StringBuilder</span> sql <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT r.name, r.role_des as name FROM users u INNER JOIN user_role ur ON u.userid = ur.userid \\r\\n&quot;</span>
						<span class="token operator">+</span> <span class="token string">&quot;INNER JOIN roles r ON r.role_id =ur.role_id &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;WHERE 1=1 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot; and email=:email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token class-name">NativeQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Roles</span><span class="token punctuation">&gt;</span></span> query <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Session</span><span class="token punctuation">)</span> entityManager<span class="token punctuation">.</span><span class="token function">getDelegate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createNativeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			query<span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		query<span class="token punctuation">.</span><span class="token function">addScalar</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token class-name">StandardBasicTypes</span><span class="token punctuation">.</span>STRING<span class="token punctuation">)</span><span class="token punctuation">;</span>
		query<span class="token punctuation">.</span><span class="token function">setResultTransformer</span><span class="token punctuation">(</span><span class="token class-name">Transformers</span><span class="token punctuation">.</span><span class="token function">aliasToBean</span><span class="token punctuation">(</span><span class="token class-name">Roles</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> query<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em>UserRepo.java</em></p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UsersReponsitory</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Users</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
	<span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Users</span><span class="token punctuation">&gt;</span></span><span class="token function">findByEmail</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="tao-cac-object-authentication" tabindex="-1"><a class="header-anchor" href="#tao-cac-object-authentication" aria-hidden="true">#</a> T\u1EA1o c\xE1c Object Authentication</h2><ul><li>L\u1EDBp <code>AuthenticationRequest</code> \u0111\u1EC3 nh\u1EADn data t\u1EEB request \u0111\u0103ng nh\u1EADp.</li></ul><p><em>AuthenticationRequest.java</em></p><div class="language-java ext-java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>davisys<span class="token punctuation">.</span>auth</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthenticationRequest</span> <span class="token punctuation">{</span>
	<span class="token class-name">String</span> email<span class="token punctuation">;</span>
	<span class="token class-name">String</span> password<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>L\u1EDBp <code>AutenticationResponse</code> \u0111\u1EC3 tr\u1EA3 v\u1EC1 <mark>Token</mark> khi \u0111\u0103ng nh\u1EADp.</li></ul><div class="language-java ext-java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>davisys<span class="token punctuation">.</span>auth</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collection</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>authority<span class="token punctuation">.</span></span><span class="token class-name">SimpleGrantedAuthority</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthenticationResponse</span> <span class="token punctuation">{</span>
	<span class="token class-name">String</span> name<span class="token punctuation">;</span>
	<span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SimpleGrantedAuthority</span><span class="token punctuation">&gt;</span></span> roles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> token<span class="token punctuation">;</span>
	<span class="token class-name">String</span> refreshToken<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="tao-cac-services" tabindex="-1"><a class="header-anchor" href="#tao-cac-services" aria-hidden="true">#</a> T\u1EA1o c\xE1c services</h2><h3 id="lop-jwtservice" tabindex="-1"><a class="header-anchor" href="#lop-jwtservice" aria-hidden="true">#</a> L\u1EDBp JwtService</h3><p>T\u1EA1o l\u1EDBp <code>JwtService.java</code> v\xE0 th\xEAm hai ph\u01B0\u01A1ng th\u1EE9c sau:</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JwtService</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${jwt.secret}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> secret<span class="token punctuation">;</span>
	
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span>    JWT_TOKEN_VALIDITY  <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span> 
	
	<span class="token comment">// ph\u01B0\u01A1ng th\u1EE9c kh\u1EDFi t\u1EA1o access token</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">generateToken</span><span class="token punctuation">(</span><span class="token class-name">Users</span> user<span class="token punctuation">,</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SimpleGrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Algorithm</span> algorithm <span class="token operator">=</span> <span class="token class-name">Algorithm</span><span class="token punctuation">.</span><span class="token function">HMAC256</span><span class="token punctuation">(</span>secret<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token keyword">return</span> JWT<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">withSubject</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">withExpiresAt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span> JWT_TOKEN_VALIDITY<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">withClaim</span><span class="token punctuation">(</span><span class="token string">&quot;roles&quot;</span><span class="token punctuation">,</span> authorities<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">GrantedAuthority</span><span class="token operator">::</span> <span class="token function">getAuthority</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>algorithm<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// ph\u01B0\u01A1ng th\u1EE9c kh\u1EDFi t\u1EA1o refresh token</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">generateRefreshToken</span><span class="token punctuation">(</span><span class="token class-name">Users</span> user<span class="token punctuation">,</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SimpleGrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Algorithm</span> algorithm <span class="token operator">=</span> <span class="token class-name">Algorithm</span><span class="token punctuation">.</span><span class="token function">HMAC256</span><span class="token punctuation">(</span>secret<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token keyword">return</span> JWT<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">withSubject</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">withExpiresAt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>JWT_TOKEN_VALIDITY<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>algorithm<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="lop-authenticationservice" tabindex="-1"><a class="header-anchor" href="#lop-authenticationservice" aria-hidden="true">#</a> L\u1EDBp Authenticationservice</h3><p>B\xEAn trong l\u1EDBp <code>AuthenticationService.java</code> t\u1EA1o ph\u01B0\u01A1ng th\u1EE9c <code>LoginAuth</code></p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@RequiredArgsConstructor</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableWebSecurity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthenticationService</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">UsersReponsitory</span> usersReponsitory<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AuthenticationManager</span> authenticationManager<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RoleCustomRepo</span> roleCustomRepo<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">JwtService</span> jwtService<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">PasswordEncoder</span> passwordEncoder<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">AuthenticationResponse</span> <span class="token function">loginAuth</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationRequest</span> authenticationRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token comment">// t\xECm ki\u1EBFm user v\u1EDBi email nh\u1EADn t\u1EEB Request</span>
			<span class="token class-name">Users</span> user <span class="token operator">=</span> usersReponsitory<span class="token punctuation">.</span><span class="token function">findByEmail</span><span class="token punctuation">(</span>authenticationRequest<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">.</span><span class="token function">isAccount_status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

			<span class="token comment">// N\u1EBFu t\u1ED3n t\u1EA1i v\xE0 kh\xF4ng b\u1ECB kh\xF3a th\xEC t\u1EA1o ra token</span>
			<span class="token class-name">UsernamePasswordAuthenticationToken</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">(</span>
				authenticationRequest<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> authenticationRequest<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// l\u1EA5y ra c\xE1c quy\u1EC1n c\u1EE7a User v\xE0 truy\u1EC1n v\xE0o token</span>
			<span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SimpleGrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Roles</span><span class="token punctuation">&gt;</span></span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			role<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>c <span class="token operator">-&gt;</span> set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Roles</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			user<span class="token punctuation">.</span><span class="token function">setRoles</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>
			set<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> authorities<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleGrantedAuthority</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			authenticationManager<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">var</span> jwtToken <span class="token operator">=</span> jwtService<span class="token punctuation">.</span><span class="token function">generateToken</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> authorities<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">var</span> jwtRefreshToken <span class="token operator">=</span> jwtService<span class="token punctuation">.</span><span class="token function">generateRefreshToken</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> authorities<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// Tr\u1EA3 v\u1EC1 th\xF4ng tin c\u1EA7n thi\u1EBFt</span>
			<span class="token keyword">return</span> <span class="token class-name">AuthenticationResponse</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">token</span><span class="token punctuation">(</span>jwtToken<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">refreshToken</span><span class="token punctuation">(</span>jwtRefreshToken<span class="token punctuation">)</span>
					<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getFull_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span>authorities<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="viet-api" tabindex="-1"><a class="header-anchor" href="#viet-api" aria-hidden="true">#</a> Vi\u1EBFt API</h2><h3 id="viet-api-\u0111ang-nhap" tabindex="-1"><a class="header-anchor" href="#viet-api-\u0111ang-nhap" aria-hidden="true">#</a> Vi\u1EBFt api \u0111\u0103ng nh\u1EADp</h3><p>T\u1EA1o l\u1EDBp <code>LoginCtrl.java</code> b\xEAn trong package Controller</p><p>M\xECnh ch\u1EC9 vi\u1EBFt <code>controller</code> \u0111\u1EC3 tr\u1EA3 v\u1EC1 <code>token</code> n\u1EBFu <code>Request</code> h\u1EE3p l\u1EC7, c\xF2n ph\u1EA7n ki\u1EC3m tra c\xE1c th\xF4ng tin kh\xE1c v\xE0 tr\u1EA3 v\u1EC1 th\u1EBF n\xE0o c\xE1c b\u1EA1n c\xF3 th\u1EC3 custom code l\u1EA1i nh\xE1.</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/oauth/login&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AuthenticationResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">authLog</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">AuthenticationRequest</span> authenticationRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>authenticationService<span class="token punctuation">.</span><span class="token function">authenticationResponse</span><span class="token punctuation">(</span>authenticationRequest<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="loi-ket" tabindex="-1"><a class="header-anchor" href="#loi-ket" aria-hidden="true">#</a> L\u1EDDi k\u1EBFt</h2>`,38),O=n("Tr\xEAn l\xE0 to\xE0n b\u1ED9 v\u1EC1 "),M=s("a",{href:""},"JWT",-1),B=n(" trong "),V=n("SpringBoot"),J=n("."),H=n("K\xEC sau ch\xFAng ta s\u1EBD c\xF9ng t\xECm hi\u1EC3u v\u1EC1 "),Y=s("a",{href:""},"Security",-1),F=n(" trong "),Q=n("SpringBoot"),W=n(" nh\xE9..."),G=o('<p>Ch\xFAc c\xE1c b\u1EA1n h\u1ECDc t\u1EADp vui v\u1EBB.</p><h2 id="chu-thich" tabindex="-1"><a class="header-anchor" href="#chu-thich" aria-hidden="true">#</a> Ch\xFA th\xEDch</h2><h4 id="spring" tabindex="-1"><a class="header-anchor" href="#spring" aria-hidden="true">#</a> Spring</h4><ul><li><p><strong>SpringBoot</strong>: M\u1ED9t <strong>Framework</strong> l\u1EADp tr\xECnh ph\xEDa <em>back-end</em> r\u1EA5t ph\u1ED5 bi\u1EBFn c\u1EE7a Java.</p></li><li><p><strong>Spring Tools Sute</strong>: C\xF4ng c\u1EE5 m\u1EDF r\u1ED9ng c\u1EE7a Eclipse. Spring Tool Suite (STS) l\xE0 m\u1ED9t c\xF4ng c\u1EE5 m\u1EDF r\u1ED9ng c\u1EE7a Eclipse. S\u1EED d\u1EE5ng \u0111\u1EC3 ph\xE1t tri\u1EC3n c\xE1c \u1EE9ng d\u1EE5ng Web v\u1EDBi Spring.</p></li><li><p><strong>VS Code</strong>: M\u1ED9t Code Editor (kh\xF4ng ph\u1EA3i IDE). Ph\u1ED5 bi\u1EBFn cho vi\u1EC7c l\u1EADp tr\xECnh, h\u1ED7 tr\u1EE3 nhi\u1EC1u ng\xF4n ng\u1EEF.</p></li><li><p><strong><code>application.properties</code></strong>: M\u1ED9t file khai b\xE1o c\xE1c bi\u1EBFn m\xF4i tr\u01B0\u1EDDng trong \u1EE9ng d\u1EE5ng <strong>SpringBoot</strong> (T\u01B0\u01A1ng t\u1EF1 nh\u01B0 <code>.env</code> trong NodeJS).</p></li></ul><h4 id="token" tabindex="-1"><a class="header-anchor" href="#token" aria-hidden="true">#</a> Token</h4><ul><li><strong>AccessToken</strong>: <em>Token</em> \u0111\xE3 \u0111\u01B0\u1EE3c x\xE1c minh</li><li><strong>RefreshToken</strong>: <em>Token</em> d\u1EF1 b\u1ECB khi n\xE0o <em>AccessToken</em> h\u1EBFt h\u1EA1n th\xEC <em>RefreshToken</em> s\u1EBD \u0111\u01B0\u1EE3c thay th\u1EBF cho <em>Token</em> c\u0169</li><li><strong>SECRET KEY</strong>: M\u1ED9t th\xE0nh ph\u1EA7n quan tr\u1ECDng \u0111\u1EC3 <em>server</em> <strong>ki\u1EC3m tra t\xEDnh h\u1EE3p l\u1EC7</strong> c\u1EE7a <em>Token</em></li></ul><h4 id="t-sql" tabindex="-1"><a class="header-anchor" href="#t-sql" aria-hidden="true">#</a> T-SQL</h4><ul><li><strong>T-SQL</strong>: m\u1ED9t <a href="">ng\xF4n ng\u1EEF l\u1EADp tr\xECnh</a> ph\xEDa <em>database</em> s\u1EED d\u1EE5ng c\xE1c c\xE2u l\u1EC7nh <strong>SQL</strong></li></ul><h4 id="front-end" tabindex="-1"><a class="header-anchor" href="#front-end" aria-hidden="true">#</a> Front-end</h4><ul><li><strong>Angular</strong>: M\u1ED9t <em>Framework</em> ph\xEDa Front-end \u0111\u01B0\u1EE3c x\xE2y d\u1EF1ng b\u1EB1ng <a href="">TypeScript</a></li><li><strong>JQuery</strong>: th\u01B0 vi\u1EC7n c\u1EE7a <strong>JavaScript</strong></li><li><strong>Ajax</strong>: l\xE0 ph\u01B0\u01A1ng th\u1EE9c trao \u0111\u1ED5i d\u1EEF li\u1EC7u v\u1EDBi m\xE1y ch\u1EE7 v\xE0 c\u1EADp nh\u1EADt m\u1ED9t hay nhi\u1EC1u ph\u1EA7n c\u1EE7a trang web, ho\xE0n to\xE0n <em>kh\xF4ng reload l\u1EA1i to\xE0n b\u1ED9 trang</em>.</li><li><strong>HTML</strong>: ng\xF4n ng\u1EEF \u0111\xE1nh d\u1EA5u, x\xE2y d\u1EF1ng website</li></ul><hr>',11);function $(P,K){const a=u("RouterLink");return e(),c("div",null,[k,s("ul",null,[s("li",null,[r,d,g,t(a,{to:"/spring-boot/"},{default:p(()=>[m]),_:1}),h]),y]),w,s("div",b,[(e(),c("svg",v,A)),S,s("p",null,[N,t(a,{to:"/post/backend/jwt-springboot/#spring"},{default:p(()=>[R]),_:1}),_,E,L]),s("p",null,[q,t(a,{to:"/post/backend/jwt-springboot/#spring"},{default:p(()=>[j]),_:1}),C])]),x,s("ul",null,[s("li",null,[U,t(a,{to:"/post/backend/jwt-springboot/#spring"},{default:p(()=>[I]),_:1})])]),D,s("p",null,[O,M,B,t(a,{to:"/post/backend/jwt-springboot/#spring"},{default:p(()=>[V]),_:1}),J]),s("p",null,[H,Y,F,t(a,{to:"/post/backend/jwt-springboot/#spring"},{default:p(()=>[Q]),_:1}),W]),G])}var Z=l(i,[["render",$],["__file","index.html.vue"]]);export{Z as default};
